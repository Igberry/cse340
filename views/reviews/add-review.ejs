<%- include('../partials/head.ejs') %>
<%- include('../partials/header') %>
<%- include('../partials/navigations') %>

<main class="review-form-container">
    <h1><%= title %></h1>

    <div class="vehicle-info">
        <h2><%= vehicle.inv_year %> <%= vehicle.inv_make %> <%= vehicle.inv_model %></h2>
        <img src="<%= vehicle.inv_thumbnail %>" alt="<%= vehicle.inv_make %> <%= vehicle.inv_model %>">
    </div>

    <% if (errors && errors.length > 0) { %>
        <ul class="error-list">
            <% errors.forEach(error => { %>
                <li class="error-message"><%= error.msg %></li>
            <% }); %>
        </ul>
    <% } %>

    <form action="/reviews/add" method="POST" class="review-form">
        <input type="hidden" name="inv_id" value="<%= vehicle.inv_id %>">

        <div class="form-group">
            <label for="review_rating">Rating (1-5 stars)</label>
            <select id="review_rating" name="review_rating" required>
                <option value="">Select Rating</option>
                <option value="5" <%= review_rating == '5' ? 'selected' : '' %>>⭐⭐⭐⭐⭐ (5 stars)</option>
                <option value="4" <%= review_rating == '4' ? 'selected' : '' %>>⭐⭐⭐⭐ (4 stars)</option>
                <option value="3" <%= review_rating == '3' ? 'selected' : '' %>>⭐⭐⭐ (3 stars)</option>
                <option value="2" <%= review_rating == '2' ? 'selected' : '' %>>⭐⭐ (2 stars)</option>
                <option value="1" <%= review_rating == '1' ? 'selected' : '' %>>⭐ (1 star)</option>
            </select>
        </div>

        <div class="form-group">
            <label for="review_text">Your Review (10-500 characters)</label>
            <textarea 
                id="review_text" 
                name="review_text" 
                rows="5" 
                required 
                minlength="10" 
                maxlength="500"
                placeholder="Share your experience with this vehicle..."
            ><%= review_text || '' %></textarea>
            <small>Characters: <span id="charCount">0</span>/500</small>
        </div>

        <button type="submit" class="btn-primary">Submit Review</button>
        <a href="/inv/detail/<%= vehicle.inv_id %>" class="btn-secondary">Cancel</a>
    </form>
</main>

<script>
    // Character counter
    const textarea = document.getElementById('review_text');
    const charCount = document.getElementById('charCount');
    
    function updateCount() {
        charCount.textContent = textarea.value.length;
    }
    
    textarea.addEventListener('input', updateCount);
    updateCount();
</script>

<%- include('../partials/footer.ejs') %>
